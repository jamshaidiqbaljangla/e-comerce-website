const ProductDetail=(function(){'use strict';const state={product:null,quantity:1,selectedColor:null,selectedVariations:{},currentTab:'description',reviewsLoaded:false};let elements={};function init(){console.log('[DEBUG]ProductDetail:Initializing...');cacheElements();loadProductData();setupEventListeners();console.log('[DEBUG]ProductDetail:Initialization complete.');}function cacheElements(){elements={productContainer:document.querySelector('.product-details'),productTitle:document.querySelector('.product-title'),productPrice:document.querySelector('.product-price'),currentPrice:document.querySelector('.current-price'),oldPrice:document.querySelector('.old-price'),discountBadge:document.querySelector('.discount-badge'),mainImage:document.getElementById('main-product-image'),thumbnails:document.querySelectorAll('.thumbnail'),colorOptions:document.querySelectorAll('.color-option'),selectedVariation:document.querySelector('.selected-variation'),quantityInput:document.getElementById('product-quantity'),decreaseQuantityBtn:document.querySelector('.quantity-decrease'),increaseQuantityBtn:document.querySelector('.quantity-increase'),addToCartBtn:document.querySelector('.add-to-cart-btn'),wishlistBtn:document.querySelector('.wishlist-btn'),tabButtons:document.querySelectorAll('.tab-btn'),tabContents:document.querySelectorAll('.tab-content'),productZoom:document.querySelector('.product-zoom'),zoomModal:document.getElementById('image-zoom-modal'),zoomedImage:document.getElementById('zoomed-image'),zoomThumbnails:document.querySelector('.zoom-thumbnails'),zoomClose:document.querySelector('.zoom-close')};}function loadProductData(){const productContainer=elements.productContainer;if(!productContainer){console.error('[DEBUG]ProductDetail:Product container not found.');return;}const productId=productContainer.getAttribute('data-product-id');if(!productId){console.error('[DEBUG]ProductDetail:Product ID not specified in data-product-id attribute.');return;}if(typeof window.PRODUCTS==='undefined'||!window.PRODUCTS.getProductById){console.error('[DEBUG]ProductDetail:PRODUCTS data not available.');return;}const product=window.PRODUCTS.getProductById(productId);if(!product){console.error(`[DEBUG]ProductDetail:Product with ID ${productId}not found.`);return;}state.product=product;if(elements.colorOptions&&elements.colorOptions.length>0){const selectedColor=elements.colorOptions[0].getAttribute('data-color');state.selectedColor=selectedColor;}updateProductDisplay();}function updateProductDisplay(){console.log('[DEBUG]ProductDetail:Using static product data');}function setupEventListeners(){if(elements.thumbnails){elements.thumbnails.forEach(thumbnail=>{thumbnail.addEventListener('click',handleThumbnailClick);});}if(elements.colorOptions){elements.colorOptions.forEach(option=>{option.addEventListener('click',handleColorOptionClick);});}if(elements.decreaseQuantityBtn){elements.decreaseQuantityBtn.addEventListener('click',decreaseQuantity);}if(elements.increaseQuantityBtn){elements.increaseQuantityBtn.addEventListener('click',increaseQuantity);}if(elements.quantityInput){elements.quantityInput.addEventListener('change',updateQuantity);}if(elements.addToCartBtn){elements.addToCartBtn.addEventListener('click',handleAddToCart);}if(elements.wishlistBtn){elements.wishlistBtn.addEventListener('click',handleWishlistToggle);}if(elements.tabButtons){elements.tabButtons.forEach(button=>{button.addEventListener('click',handleTabClick);});}if(elements.productZoom){elements.productZoom.addEventListener('click',openZoomModal);}if(elements.zoomClose){elements.zoomClose.addEventListener('click',closeZoomModal);}const reviewLink=document.querySelector('.review-link');if(reviewLink){reviewLink.addEventListener('click',function(e){e.preventDefault();const reviewsTab=document.querySelector('.tab-btn[data-tab="reviews"]');if(reviewsTab){reviewsTab.click();const reviewsSection=document.getElementById('reviews-tab');if(reviewsSection){setTimeout(()=>{reviewsSection.scrollIntoView({behavior:'smooth'});},100);}}});}}function handleThumbnailClick(event){const thumbnail=event.currentTarget;const imageUrl=thumbnail.getAttribute('data-image');if(elements.mainImage&&imageUrl){elements.mainImage.src=imageUrl;elements.thumbnails.forEach(thumb=>{thumb.classList.remove('active');});thumbnail.classList.add('active');}}function handleColorOptionClick(event){const colorOption=event.currentTarget;const color=colorOption.getAttribute('data-color');state.selectedColor=color;elements.colorOptions.forEach(option=>{option.classList.remove('selected');});colorOption.classList.add('selected');if(elements.selectedVariation){elements.selectedVariation.textContent=color;}}function decreaseQuantity(){if(!elements.quantityInput)return;const currentValue=parseInt(elements.quantityInput.value,10);const minValue=parseInt(elements.quantityInput.getAttribute('min'),10)||1;if(currentValue>minValue){elements.quantityInput.value=currentValue-1;state.quantity=currentValue-1;}}function increaseQuantity(){if(!elements.quantityInput)return;const currentValue=parseInt(elements.quantityInput.value,10);const maxValue=parseInt(elements.quantityInput.getAttribute('max'),10)||999;if(currentValue<maxValue){elements.quantityInput.value=currentValue+1;state.quantity=currentValue+1;}}function updateQuantity(){if(!elements.quantityInput)return;let value=parseInt(elements.quantityInput.value,10);const minValue=parseInt(elements.quantityInput.getAttribute('min'),10)||1;const maxValue=parseInt(elements.quantityInput.getAttribute('max'),10)||999;if(isNaN(value)||value<minValue){value=minValue;}else if(value>maxValue){value=maxValue;}elements.quantityInput.value=value;state.quantity=value;}function handleAddToCart(){if(typeof window.CartManager==='undefined'||!window.CartManager.addToCart){console.error('[DEBUG]ProductDetail:CartManager not available.');return;}const productContainer=elements.productContainer;if(!productContainer)return;const productId=productContainer.getAttribute('data-product-id');if(!productId)return;const quantity=state.quantity;window.CartManager.addToCart(productId,quantity,{color:state.selectedColor});}function handleWishlistToggle(){if(typeof window.WishlistManager==='undefined'||!window.WishlistManager.toggleWishlistItem){console.error('[DEBUG]ProductDetail:WishlistManager not available.');return;}const productContainer=elements.productContainer;if(!productContainer)return;const productId=productContainer.getAttribute('data-product-id');if(!productId)return;const isAdded=window.WishlistManager.toggleWishlistItem(productId);if(elements.wishlistBtn){if(isAdded){elements.wishlistBtn.classList.add('active');elements.wishlistBtn.querySelector('i').classList.remove('far');elements.wishlistBtn.querySelector('i').classList.add('fas');}else{elements.wishlistBtn.classList.remove('active');elements.wishlistBtn.querySelector('i').classList.remove('fas');elements.wishlistBtn.querySelector('i').classList.add('far');}}}function handleTabClick(event){const tabButton=event.currentTarget;const tabName=tabButton.getAttribute('data-tab');elements.tabButtons.forEach(button=>{button.classList.remove('active');});tabButton.classList.add('active');elements.tabContents.forEach(content=>{content.classList.remove('active');});const tabContent=document.getElementById(`${tabName}-tab`);if(tabContent){tabContent.classList.add('active');}state.currentTab=tabName;if(tabName==='reviews'&&!state.reviewsLoaded){loadReviews();}}function loadReviews(){if(typeof window.ProductReviewsIntegration!=='undefined'&&typeof window.ProductReviewsIntegration.init==='function'){window.ProductReviewsIntegration.init();state.reviewsLoaded=true;}else{console.log('[DEBUG]ProductDetail:ProductReviewsIntegration not available. Using static review data.');}}function openZoomModal(){if(!elements.zoomModal||!elements.mainImage)return;elements.zoomedImage.src=elements.mainImage.src;if(elements.zoomThumbnails&&elements.thumbnails.length>0){elements.zoomThumbnails.innerHTML='';elements.thumbnails.forEach((thumbnail,index)=>{const imageUrl=thumbnail.getAttribute('data-image');const thumbElement=document.createElement('div');thumbElement.classList.add('zoom-thumbnail');if(elements.mainImage.src===imageUrl){thumbElement.classList.add('active');}const thumbImage=document.createElement('img');thumbImage.src=imageUrl;thumbImage.alt=`Thumbnail ${index+1}`;thumbElement.appendChild(thumbImage);elements.zoomThumbnails.appendChild(thumbElement);thumbElement.addEventListener('click',()=>{elements.zoomedImage.src=imageUrl;const allThumbs=elements.zoomThumbnails.querySelectorAll('.zoom-thumbnail');allThumbs.forEach(thumb=>{thumb.classList.remove('active');});thumbElement.classList.add('active');});});}elements.zoomModal.classList.add('show');document.body.style.overflow='hidden';}function closeZoomModal(){if(!elements.zoomModal)return;elements.zoomModal.classList.remove('show');document.body.style.overflow='';}return{init:init};})();document.addEventListener('DOMContentLoaded',function(){ProductDetail.init();});