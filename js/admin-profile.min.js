document.addEventListener('DOMContentLoaded',function(){loadProfile();setupEventListeners();});function setupEventListeners(){const profileForm=document.getElementById('profile-form');if(profileForm){profileForm.addEventListener('submit',updateProfile);}const passwordForm=document.getElementById('password-form');if(passwordForm){passwordForm.addEventListener('submit',changePassword);}}async function loadProfile(){try{showLoading(true);const response=await fetch('/api/admin/profile');const data=await response.json();if(data.success){populateProfileForm(data.profile);}else{showError('Failed to load profile:'+data.message);}}catch(error){console.error('Error loading profile:',error);showError('Failed to load profile data.');}finally{showLoading(false);}}function populateProfileForm(profile){document.getElementById('first-name').value=profile.first_name||'';document.getElementById('last-name').value=profile.last_name||'';document.getElementById('email').value=profile.email||'';document.getElementById('profile-avatar').src=profile.avatar_url||'https:}async function updateProfile(event){event.preventDefault();const formData=new FormData(event.target);const data=Object.fromEntries(formData.entries());try{const response=await fetch('/api/admin/profile',{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});const result=await response.json();if(result.success){showSuccess('Profile updated successfully!');loadProfile();}else{showError('Failed to update profile:'+result.message);}}catch(error){console.error('Error updating profile:',error);showError('An error occurred while updating the profile.');}}async function changePassword(event){event.preventDefault();const currentPassword=document.getElementById('current-password').value;const newPassword=document.getElementById('new-password').value;const confirmPassword=document.getElementById('confirm-password').value;if(newPassword!==confirmPassword){showError("New passwords do not match.");return;}try{const response=await fetch('/api/admin/profile/change-password',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({currentPassword,newPassword})});const result=await response.json();if(result.success){showSuccess('Password changed successfully!');event.target.reset();}else{showError('Failed to change password:'+result.message);}}catch(error){console.error('Error changing password:',error);showError('An error occurred while changing the password.');}}function showLoading(show){const formOverlays=document.querySelectorAll('.form-overlay');formOverlays.forEach(overlay=>{overlay.style.display=show?'flex':'none';});}function showError(message){Swal.fire({icon:'error',title:'Error',text:message});}function showSuccess(message){Swal.fire({icon:'success',title:'Success',text:message,timer:2000,showConfirmButton:false});}